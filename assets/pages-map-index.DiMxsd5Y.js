import{r as e,a as t,c as o,w as a,g as n,i,o as s,b as l,u as r,n as d,d as c,e as u,s as g,f as p,h as m}from"./index-CK3XW3i5.js";import{_ as h,u as w,o as y}from"./_plugin-vue_export-helper.BUt6sT3K.js";import{g as f,i as b}from"./map.kLwkwUyD.js";const v=h({__name:"index",setup(h){const{initMap:v,setMapCenter:$,geoCode:S,thisMap:L,getMap:C,addMarkerList:_,clearMap:A}=w(),T=e("100vh"),x=e(null),M=e(0),N=e=>{const t=window.localStorage.getItem("uuid"),o={pageNum:1,pageSize:1e4,data:{mapName:"",latLon:"",...j(),creator:t||12123132232}};f(o).then((t=>{t&&t.list.length>3?g({title:"一天最多标记三次",icon:"error"}):(M.value=e,x.value.open())}))},D=()=>{const e=window.localStorage.getItem("uuid"),t={mapName:S.value.location,latLon:[S.value.lat,S.value.lng].join(","),delType:M.value,creator:e};console.log(t),b(t).then((e=>{e&&e.id&&H(e)}))};function j(){const e=new Date((new Date).toLocaleString("en-US",{timeZone:"Australia/Sydney"}));e.setHours(0,0,0,0);const t=new Date(e);t.setHours(23,59,59,999);const o={timeZone:"Australia/Sydney",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1};return{startTime:e.toLocaleString("en-CA",o).replace(/(\d+)\/(\d+)\/(\d+)/,"$3-$1-$2").replace(", "," "),endTime:t.toLocaleString("en-CA",o).replace(/(\d+)\/(\d+)\/(\d+)/,"$3-$1-$2").replace(", "," ")}}function k(){const e=new Date;return{startTime:new Date(e.getTime()-108e5).toLocaleString("en-CA",{timeZone:"Australia/Sydney",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+)/,"$3-$1-$2").replace(", "," "),endTime:e.toLocaleString("en-CA",{timeZone:"Australia/Sydney",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+)/,"$3-$1-$2").replace(", "," ")}}y((()=>{(()=>{const e={pageNum:1,pageSize:1e4,data:{mapName:"",latLon:"",...k()}};f(e).then((e=>{if(console.log(e),e&&e.list){e.list.forEach(((t,o)=>{t.latLon?(t.type=0==t.delType?1:2,t.position=t.latLon?t.latLon.split(",").map((e=>Number(e))):["",""],t.name=t.mapName):e.list.split(o,1)})),console.log(e.list,L.value);const t=C();_(t,e.list)}}))})(),(()=>{const e=n(),t=e.windowHeight-96-(e.safeAreaInsets.top||0);T.value=`${t}px`})(),v(),"geolocation"in navigator?navigator.geolocation.getCurrentPosition((e=>{const{latitude:t,longitude:o}=e.coords;$({lat:t,lng:o}),console.log("Updated with precise location:",t,o)}),(e=>{console.error("Error fetching precise location:",e)}),{enableHighAccuracy:!0}):console.warn("Geolocation is not supported by this browser.")}));const H=e=>{p({url:`/pages/map/add?id=${e.id}`})};function I(){const e=.8*window.screen.width,t=.7*window.screen.height,o=(window.screen.width-e)/2,a=(window.screen.height-t)/2;window.open("/otherwebs.html","otherWebsPopup",`width=${e},height=${t},left=${o},top=${a},toolbar=no,menubar=no,scrollbars=yes,resizable=yes`)}return(e,n)=>{const g=m,p=t("uni-popup-dialog"),h=t("uni-popup"),w=i;return s(),o(w,{class:"container"},{default:a((()=>[l("img",{src:r("/assets/logo-1-LHT9Or-P.jpg"),class:"logo-icon",alt:"",srcset:""},null,8,["src"]),l("div",{id:"googleMap",style:d({height:T.value})},null,4),l("div",{class:"btm-box"},[l("div",{class:"btm-btn danger-btn",onClick:n[0]||(n[0]=e=>N(0))},"一键求助"),l("div",{class:"btm-btn warn-btn",onClick:n[1]||(n[1]=e=>N(1))},"标记警告"),c(g,{id:"otherWebsites",onClick:I},{default:a((()=>[u("其他网页")])),_:1})]),c(h,{ref_key:"alertDialog",ref:x,type:"dialog"},{default:a((()=>[c(p,{type:"info",cancelText:"取消",confirmText:"确定",title:"提示",content:"是否确认"+(M.value?"标记警告":"一键求助"),onConfirm:D,onClose:n[2]||(n[2]=e=>x.value.close())},null,8,["content"])])),_:1},512)])),_:1})}}},[["__scopeId","data-v-d7d88111"]]);export{v as default};
