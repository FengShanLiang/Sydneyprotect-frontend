import{j as e,r as l,z as a,a as t,c as i,w as o,i as n,o as s,b as u,d,t as p,e as r,u as c,k as m,l as v,F as y,A as f,p as h,s as g,f as x,q as _,x as k,h as w}from"./index-CK3XW3i5.js";import{_ as C,u as b,a as U,c as T,d as F}from"./_plugin-vue_export-helper.BUt6sT3K.js";import{a as V,u as j,b as L,d as D}from"./map.kLwkwUyD.js";const E=C({__name:"add",setup(C){const{openMap:E}=b();U((l=>{console.log("å‚æ•°:",l.id,l.name),V({id:l.id}).then((l=>{N.value=l,e({title:"0"==N.value.delType?"æ–°å¢žæ±‚åŠ©":"æ–°å¢žæ ‡è®°è­¦å‘Š"});let a=[],t=[];l.fileList&&l.fileList.length&&l.fileList.forEach((e=>{".mp3"===e.fileType?(e.url=`${T.imgUrl}${e.dowenloadUrl}`,t.push(e)):a.push(e)})),ee.value=t,P.value=a.map((e=>e.id))||[],$.value=l.latLon.split(","),a.forEach((e=>{I(e)}))}))})),l(0);const $=l([]),M=l([]),N=l({delContent:"",delFile:"",mapName:""}),P=l([]),R=l(0),z=l(null),S=()=>{h({phoneNumber:"000"})},A=e=>{console.log("é€‰æ‹©æ–‡ä»¶ï¼š",e),B(e)},O=()=>{},q=e=>{P.value.splice(e.tempFile.index,1)},B=e=>{console.log(e);let l={name:"file",filePath:e.tempFilePaths[0],uid:N.value.creator};g({icon:"loading",duration:99999}),j(l).then((e=>{console.log(e),200==e.httpCode?(P.value.push(e.data.id),I(e.data)):g({title:"ä¸Šä¼ å‡ºé”™,é‡æ–°ä¸Šä¼ ",icon:"error"})}))},I=e=>{M.value.push({url:T.imgUrl+e.dowenloadUrl,name:"image",id:e.id}),R.value++,a()},J=()=>{D({id:N.value.id}).then((e=>{g({title:"å–æ¶ˆæ ‡è®°æˆåŠŸ",icon:"success"}),setTimeout((()=>{x({url:"/"})}),1e3)}))};let G=null,H=[],K=null;const Q=l(!1);let W=null;const X=async()=>{K=await navigator.mediaDevices.getUserMedia({audio:!0}),G=new MediaRecorder(K),H=[],G.ondataavailable=e=>{H.push(e.data)},G.onstop=e=>{e.tempFilePath;const l=new Blob(H,{type:"audio/mp3"});URL.createObjectURL(l),Q.value=!1;const a=new File([l],"record.mp3",{type:"audio/mp3",lastModified:Date.now()});Z(a)},G.start(),Q.value=!0,W=window.setTimeout((()=>{console.log("â±ï¸ å·²è¾¾æœ€å¤§å½•éŸ³æ—¶é•¿ï¼Œè‡ªåŠ¨åœæ­¢"),Y()}),6e4)},Y=()=>{G&&"inactive"!==G.state&&G.stop(),W&&(clearTimeout(W),W=null),K&&K.getTracks().forEach((e=>e.stop()))},Z=e=>{const l=new FormData;l.append("file",e),l.append("uid","222"),g({icon:"loading",duration:99999}),fetch("https://www.sydneyalertmap.com/adly-api/sysFile/upload",{method:"POST",body:l}).then((e=>e.json())).then((e=>{console.log(e),a(),200==e.httpCode?ee.value.push({url:`${T.imgUrl}${e.data.dowenloadUrl}`,id:e.data.id}):g({title:"ä¸Šä¼ å‡ºé”™,é‡æ–°å½•åˆ¶",icon:"error"})})).catch((e=>{a(),g({title:"ä¸Šä¼ å‡ºé”™,é‡æ–°å½•åˆ¶",icon:"error"})}))},ee=l([]);let le=null;const ae=l(-1),te=l(!1),ie=()=>{le&&(le.paused?(le.play(),te.value=!0):(le.pause(),te.value=!1))};return F((()=>{le&&(le.pause(),le.currentTime=0,le=null,console.log("ðŸ”‡ ç¦»å¼€é¡µé¢å·²é”€æ¯ audio"))})),(e,l)=>{const h=_,C=k,b=w,U=t("uni-list"),T=t("uni-card"),F=t("uni-easyinput"),V=t("uni-file-picker"),j=n,D=t("uni-forms"),B=t("uni-popup-dialog"),I=t("uni-popup");return s(),i(j,{class:"container"},{default:o((()=>[u("div",{class:"title"},[d(h,{style:{width:"150rpx",height:"150rpx",display:"block",margin:"auto"},src:"/assets/success-DDJ6pRU8.png"}),u("div",{style:{"font-size":"20px","font-weight":"bold","margin-top":"40rpx"}},p("0"==N.value.delType?"æ‚¨å·²å‘å¸ƒæ±‚åŠ©":"æ‚¨å·²å‘å¸ƒè­¦å‘Š"),1),d(T,{title:"åŸºç¡€å¡ç‰‡",extra:"é¢å¤–ä¿¡æ¯"},{title:o((()=>[d(U,{style:{padding:"20rpx"}},{default:o((()=>[u("h3",{style:{"text-align":"left"}},"è¯¦ç»†åœ°å€"),d(C,{style:{"text-align":"left"}},{default:o((()=>[r(p(N.value.mapName),1)])),_:1}),d(b,{type:"primary",onClick:l[0]||(l[0]=e=>c(E)($.value[0],$.value[1],N.value.mapName)),style:{"margin-top":"20rpx",width:"150px"}},{default:o((()=>[r(" æ‰“å¼€å¯¼èˆª ")])),_:1})])),_:1})])),default:o((()=>[u("div",{style:{"text-align":"left",color:"black"}},[u("div",null,"åŒ—çº¬ï¼š"+p($.value[0]),1),u("div",null,"ä¸œç»ï¼š"+p($.value[1]),1)])])),_:1})]),u("div",{class:"button-container"},[d(b,{type:"primary",style:{width:"500rpx","font-size":"40rpx"},onClick:S},{default:o((()=>[r(" 000 ")])),_:1}),u("div",{style:{"margin-top":"20rpx"}},"ç´§æ€¥æ±‚åŠ©ç”µè¯")]),d(j,{class:"example"},{default:o((()=>[d(D,{ref:"valiForm",style:{"margin-top":"40rpx"}},{default:o((()=>[d(F,{type:"text",style:{"margin-bottom":"40rpx"},modelValue:N.value.phone,"onUpdate:modelValue":l[1]||(l[1]=e=>N.value.phone=e),placeholder:"è¯·è¾“å…¥è”ç³»æ–¹å¼"},null,8,["modelValue"]),d(F,{type:"textarea",modelValue:N.value.delContent,"onUpdate:modelValue":l[2]||(l[2]=e=>N.value.delContent=e),placeholder:"è¯·è¾“å…¥è¡¥å……æ–‡å­—æè¿°"},null,8,["modelValue"]),d(j,{class:"example-body"},{default:o((()=>[(s(),i(V,{limit:"9",count:"1",key:R.value,onDelete:q,onSuccess:O,title:"æ·»åŠ å›¾ç‰‡,æœ€å¤šé€‰æ‹©9å¼ å›¾ç‰‡",modelValue:M.value,"onUpdate:modelValue":l[3]||(l[3]=e=>M.value=e),onSelect:A},null,8,["modelValue"]))])),_:1})])),_:1},512),u("div",{class:"liuyan"},"æ·»åŠ ç•™è¨€,æœ€å¤šå¯ä¸Šä¼ 5æ¡"),ee.value?(s(),i(j,{key:0},{default:o((()=>[(s(!0),m(y,null,v(ee.value,((e,l)=>(s(),i(j,{key:`audio-${l}`},{default:o((()=>[u("div",{style:{display:"flex","align-items":"center"}},[u("div",{class:"liuyan-item",onClick:t=>((e,l)=>{if(ae.value!=l)return g({icon:"loading",duration:99999}),le&&le.play&&le.pause(),ae.value=l,le=new Audio(e.url),le.addEventListener("loadedmetadata",(()=>{a(),le.play(),te.value=!0})),void le.addEventListener("ended",(()=>{te.value=!1}));ie()})(e,l)},[r(" ç•™è¨€"+p(l+1)+" ",1),te.value&&ae.value===l?(s(),m("i",{key:0,class:"pause-icon"})):(s(),m("i",{key:1,class:"play-icon"}))],8,["onClick"]),u("div",{class:"del-tip",onClick:e=>(e=>{ae.value===e&&te.value&&le&&(le.pause(),te.value=!1,ae.value=-1),ee.value.splice(e,1)})(l)},"åˆ é™¤",8,["onClick"])])])),_:2},1024)))),128))])),_:1})):f("",!0),ee.value.length<5?(s(),i(j,{key:1,class:"audio-player"},{default:o((()=>[Q.value?(s(),i(b,{key:1,type:"primary",onClick:Y},{default:o((()=>[r("åœæ­¢å½•éŸ³")])),_:1})):(s(),i(b,{key:0,type:"primary",onClick:X},{default:o((()=>[r(" å¼€å§‹å½•éŸ³ ")])),_:1}))])),_:1})):f("",!0),u("div",{style:{display:"flex","justify-content":"space-around"}},[d(b,{type:"primary",onClick:l[4]||(l[4]=e=>(()=>{const e=ee.value.map((e=>e.id));N.value.delFile=[...P.value,...e].join(","),L(N.value).then((e=>{g({title:"æ ‡è®°æˆåŠŸ",icon:"success"}),setTimeout((()=>{x({url:"/"})}),1e3)}))})()),style:{"margin-top":"40rpx",width:"40%"}},{default:o((()=>[r(" æäº¤ ")])),_:1}),d(b,{type:"primary",onClick:l[5]||(l[5]=e=>{z.value.open()}),style:{"margin-top":"40rpx",width:"40%"}},{default:o((()=>[r(" å–æ¶ˆæ ‡è®° ")])),_:1})]),d(I,{ref_key:"alertDialog",ref:z,type:"dialog"},{default:o((()=>[d(B,{type:"info",cancelText:"å–æ¶ˆ",confirmText:"ç¡®å®š",title:"æç¤º",content:"æ˜¯å¦ç¡®è®¤å–æ¶ˆæ ‡è®°",onConfirm:J,onClose:l[6]||(l[6]=e=>z.value.close())})])),_:1},512)])),_:1})])),_:1})}}},[["__scopeId","data-v-e7b2b0ec"]]);export{E as default};
