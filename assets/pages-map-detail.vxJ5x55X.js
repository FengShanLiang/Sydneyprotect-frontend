import{j as e,r as l,a,c as t,w as s,i,o as n,b as u,t as o,d as r,e as d,u as v,k as p,l as c,F as m,m as f,v as y,p as g,q as h,x,h as k,y as _,s as w,z as T}from"./index-CK3XW3i5.js";import{_ as $,u as b,a as C,c as L,b as S,d as I,e as j,f as E}from"./_plugin-vue_export-helper.BUt6sT3K.js";import{a as M}from"./map.kLwkwUyD.js";const U=$({__name:"detail",setup($){const{openMap:U}=b();C((l=>{console.log("参数:",l.id,l.name),M({id:l.id}).then((l=>{z.value=l,e({title:"0"==z.value.delType?"求助详情":"标记警告详情"});let a=[],t=[];l.fileList&&l.fileList.length&&l.fileList.forEach((e=>{".mp3"===e.fileType?(e.url=`${L.imgUrl}${e.dowenloadUrl}`,t.push(e)):a.push(e)})),H.value=t,N.value=l.latLon.split(","),a.forEach((e=>{q(e)}))}))}));const z=l({}),N=l([]),D=l([]),F=l(),q=e=>{D.value.push({url:L.imgUrl+e.dowenloadUrl,name:"image",id:e.id})};l("0");const A=l(null),B=l(!1);A.value=setInterval((()=>{B.value?clearInterval(A.value):function(){const e=new Date(z.value.createTime).getTime()+108e5-(new Date).getTime();if(e<=0)return clearInterval(A.value),void console.log("倒计时结束");const l=Math.floor(e/36e5),a=Math.floor(e%36e5/6e4),t=Math.floor(e%6e4/1e3),s=l.toString().padStart(2,"0"),i=a.toString().padStart(2,"0"),n=t.toString().padStart(2,"0");console.log(`${s}:${i}:${n}`),F.value=`${s}时${i}分${n}秒`}()}),1e3);function G(){A.value&&(clearInterval(A.value),A.value=null),F.value=""}const H=l([]);let J=null;const K=l(-1),O=l(!1),P=()=>{J&&(J.paused?(J.play(),O.value=!0):(J.pause(),O.value=!1))};return S((()=>{B.value=!0,G()})),I((()=>{B.value=!0,G(),J&&(J.pause(),J.currentTime=0,J=null,console.log("🔇 离开页面已销毁 audio"))})),(e,l)=>{const $=h,b=x,C=k,L=a("uni-list"),S=a("uni-card"),I=i;return n(),t(I,{class:"container"},{default:s((()=>[u("div",null,["0"==z.value.delType?(n(),t($,{key:0,style:{width:"60rpx",height:"60rpx"},src:j})):(n(),t($,{key:1,style:{width:"60rpx",height:"60rpx"},src:E})),u("h2",{class:"title"},o("0"==z.value.delType?"有华人请求协助":"有华人标记警告"),1),r(S,{title:"基础卡片",extra:"额外信息"},{title:s((()=>[r(L,{style:{padding:"20rpx"}},{default:s((()=>[u("h3",{style:{"text-align":"left"}},"详细地址"),r(b,{style:{"text-align":"left"}},{default:s((()=>[d(o(z.value.mapName),1)])),_:1}),r(C,{type:"primary",onClick:l[0]||(l[0]=e=>v(U)(N.value[0],N.value[1],z.value.mapName)),style:{"margin-top":"20rpx",width:"150px"}},{default:s((()=>[d(" 打开导航 ")])),_:1})])),_:1})])),default:s((()=>[u("div",{style:{color:"black","text-align":"left"}},[u("div",null,"北纬： "+o(N.value[0]),1),u("div",null,"东经："+o(N.value[1]),1)]),u("div",{style:{"margin-top":"20rpx",color:"black"},onClick:l[1]||(l[1]=e=>{return l=z.value.phone,void g({phoneNumber:l});var l})}," 联系方式："+o(z.value.phone),1),u("div",{style:{"margin-top":"20rpx",color:"black"}}," 描述信息："+o(z.value.delContent),1)])),_:1}),u("div",{class:"content"},[u("div",{class:"img-container"},[(n(!0),p(m,null,c(D.value,(e=>(n(),t($,{src:e.url,onClick:l=>(e=>{const l=D.value.map((e=>e.url));_({current:e,urls:l,indicator:"number",loop:!0})})(e.url),mode:"aspectFill"},null,8,["src","onClick"])))),256))]),f(r(I,null,{default:s((()=>[u("div",{class:"liuyan"},"留言"),(n(!0),p(m,null,c(H.value,((e,l)=>(n(),t(I,{key:`audio-${l}`},{default:s((()=>[u("div",{style:{display:"flex","align-items":"center"}},[u("div",{class:"liuyan-item",onClick:a=>((e,l)=>{if(K.value!=l)return w({icon:"loading",duration:99999}),J&&J.play&&J.pause(),K.value=l,J=new Audio(e.url),J.addEventListener("loadedmetadata",(()=>{T(),J.play(),O.value=!0})),void J.addEventListener("ended",(()=>{O.value=!1}));P()})(e,l)},[d(" 留言"+o(l+1)+" ",1),O.value&&K.value===l?(n(),p("i",{key:0,class:"pause-icon"})):(n(),p("i",{key:1,class:"play-icon"}))],8,["onClick"])])])),_:2},1024)))),128))])),_:1},512),[[y,H.value&&H.value.length]])]),u("div",{style:{"font-size":"16px","margin-top":"20rpx"}}," 发布时间："+o(z.value.createTime),1),u("div",{style:{"font-size":"16px","margin-top":"20rpx",color:"red"}}," 预计在地图保留时间： "+o(F.value),1)])])),_:1})}}},[["__scopeId","data-v-99716422"]]);export{U as default};
